services:
  teleflux:
    # Pull directly from GitHub Container Registry (GHCR).
    # NOTE: GHCR requires the repository path to be lowercase.
    image: ${TELEFLUX_IMAGE:-ghcr.io/weiyingiii/teleflux:latest}
    container_name: teleflux-bot
    restart: unless-stopped

    environment:
      # === REQUIRED: fill these three parameters ===
      API_ID: "${API_ID:-YOUR_API_ID}"
      API_HASH: "${API_HASH:-YOUR_API_HASH}"
      BOT_TOKEN: "${BOT_TOKEN:-YOUR_BOT_TOKEN}"

      # Optional
      TZ: "${TZ:-Asia/Shanghai}"

      # Optional: send a "bot started" message to these chat IDs (comma-separated)
      # Example: STARTUP_NOTIFY_CHAT_ID=123456789
      STARTUP_NOTIFY_CHAT_ID: "${STARTUP_NOTIFY_CHAT_ID:-}"

      # Optional: restrict management commands (/proxy, /concurrency) by user IDs (comma-separated)
      # Example: ADMIN_USER_IDS=123456789,987654321
      ADMIN_USER_IDS: "${ADMIN_USER_IDS:-}"

      # Optional: set proxy at startup (same format as /proxy)
      # Example: TELEFLUX_PROXY=socks5://user:pass@127.0.0.1:1080
      TELEFLUX_PROXY: "${TELEFLUX_PROXY:-}"

      # Tuning (optional)
      # Reduce concurrency if you see "File lives in another DC" then stuck at 0%
      MAX_CONCURRENT_DOWNLOADS: "${MAX_CONCURRENT_DOWNLOADS:-3}"
      # If no progress for N seconds, the task will be marked failed (helps avoid endless hangs)
      DOWNLOAD_STALL_TIMEOUT_S: "${DOWNLOAD_STALL_TIMEOUT_S:-180}"

      # Container internal paths (do not change unless you also change bot config)
      MUSIC_PATH: /data/Music
      VIDEO_PATH: /data/Video
      DOWNLOAD_PATH: /data/Download
      CACHE_PATH: /app/cache

    volumes:
      # Host directories. Defaults make the project runnable with only this YAML file.
      # You can replace these with your NAS paths (e.g. /vol2/1000/Music:/data/Music).
      - "${MUSIC_DIR:-./data/Music}:/data/Music"
      - "${VIDEO_DIR:-./data/Video}:/data/Video"
      - "${DOWNLOAD_DIR:-./data/Download}:/data/Download"

      # Keep cache persistent
      - "${CACHE_DIR:-./cache}:/app/cache"
